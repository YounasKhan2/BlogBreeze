{% extends 'base.html' %}

{% block title %}Search Results{% if query %} for "{{ query }}"{% endif %} - BlogBreeze{% endblock %}

{% block content %}
<main class="flex h-full grow flex-col">
    <div class="container mx-auto flex max-w-3xl flex-1 flex-col px-4 py-8 sm:py-12">
        <!-- Back Button -->
        <div class="mb-6">
            <a href="{% url 'blog:post_list' %}" class="inline-flex items-center gap-2 text-sm font-medium text-text-secondary-light dark:text-text-secondary-dark hover:text-primary transition-colors">
                <span class="material-symbols-outlined text-lg">arrow_back</span>
                <span>Back to Home</span>
            </a>
        </div>
        
        <!-- Search Bar -->
        <div class="mb-8">
            <label class="flex flex-col min-w-40 h-14 w-full">
                <form method="get" action="{% url 'blog:search' %}" class="flex w-full flex-1 items-stretch rounded-xl h-full border border-border-light dark:border-border-dark focus-within:ring-2 focus-within:ring-primary">
                    <div class="flex items-center justify-center pl-4 bg-background-light dark:bg-background-dark rounded-l-xl">
                        <span class="material-symbols-outlined text-text-secondary-light dark:text-text-secondary-dark">search</span>
                    </div>
                    <input 
                        name="q"
                        class="flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-text-light dark:text-text-dark focus:outline-0 focus:ring-0 border-none bg-background-light dark:bg-background-dark h-full placeholder:text-text-secondary-light dark:placeholder:text-text-secondary-dark px-2 text-base font-normal" 
                        placeholder="Search for articles..." 
                        value="{{ query }}"
                    />
                    {% if query %}
                    <div class="flex items-center justify-center bg-background-light dark:bg-background-dark pr-2">
                        <a href="{% url 'blog:search' %}" class="flex cursor-pointer items-center justify-center overflow-hidden rounded-lg bg-transparent text-text-secondary-light dark:text-text-secondary-dark hover:bg-black/5 dark:hover:bg-white/10 p-2">
                            <span class="material-symbols-outlined">close</span>
                        </a>
                    </div>
                    {% endif %}
                    <div class="flex items-center justify-center rounded-r-xl bg-background-light dark:bg-background-dark pr-4">
                        <button type="submit" class="flex cursor-pointer items-center justify-center overflow-hidden rounded-lg bg-primary text-white px-4 h-10 text-sm font-bold hover:bg-opacity-90 transition-opacity">
                            Search
                        </button>
                    </div>
                </form>
            </label>
        </div>
        
        {% if search_performed %}
            <!-- Page Heading and Results Count -->
            <div class="flex flex-wrap justify-between gap-3 mb-8 px-2">
                <div class="flex min-w-72 flex-col gap-1">
                    <h1 class="text-3xl font-black tracking-tighter sm:text-4xl text-text-light dark:text-text-dark">Search Results</h1>
                    <p class="text-base font-normal text-text-secondary-light dark:text-text-secondary-dark">
                        {% if posts %}
                            Showing {{ posts|length }} result{{ posts|length|pluralize }} for '{{ query }}'
                        {% else %}
                            No results found for '{{ query }}'
                        {% endif %}
                    </p>
                </div>
            </div>
            
            {% if posts %}
                <!-- Results List -->
                <div class="flex flex-col gap-8">
                    {% for post in posts %}
                    <div class="flex flex-col sm:flex-row items-stretch justify-between gap-6 rounded-lg p-2 hover:bg-primary/5 dark:hover:bg-primary/10 transition-colors duration-200">
                        <div class="w-full sm:w-1/3 bg-center bg-no-repeat aspect-video sm:aspect-square bg-cover rounded-lg flex-1" 
                             style="background-image: url('{% if post.featured_image %}{{ post.featured_image.url }}{% else %}https://images.unsplash.com/photo-1499750310107-5fef28a66643?w=800{% endif %}');"></div>
                        <div class="flex flex-[2_2_0px] flex-col justify-center gap-3">
                            <div class="flex flex-col gap-1">
                                <p class="text-sm font-normal text-text-secondary-light dark:text-text-secondary-dark">
                                    {{ post.author.username }} - {{ post.created_at|date:"M d, Y" }}
                                </p>
                                <p class="text-xl font-bold leading-tight hover:underline text-text-light dark:text-text-dark">
                                    <a href="{% url 'blog:post_detail' post.slug %}">{{ post.title }}</a>
                                </p>
                                <p class="text-sm font-normal text-text-secondary-light dark:text-text-secondary-dark mt-1">
                                    {% if post.description %}
                                        {{ post.description }}
                                    {% else %}
                                        {{ post.content|striptags|truncatewords:30 }}
                                    {% endif %}
                                </p>
                            </div>
                            <a href="{% url 'blog:post_detail' post.slug %}" class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-8 px-4 flex-row-reverse bg-primary/10 dark:bg-primary/20 text-primary dark:text-white/90 text-sm font-medium w-fit hover:bg-primary/20 dark:hover:bg-primary/30 transition-colors">
                                <span class="truncate">Read More</span>
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                
                <!-- Pagination -->
                {% if is_paginated %}
                <nav aria-label="Pagination" class="mt-12 flex items-center justify-center gap-2">
                    {% if page_obj.has_previous %}
                        <a href="?q={{ query }}&page={{ page_obj.previous_page_number }}" class="flex h-10 w-10 cursor-pointer items-center justify-center overflow-hidden rounded-full bg-border-light text-text-secondary-light dark:bg-border-dark dark:text-text-secondary-dark hover:bg-primary/10 dark:hover:bg-primary/20 transition-colors">
                            <span class="material-symbols-outlined">chevron_left</span>
                        </a>
                    {% else %}
                        <div class="flex h-10 w-10 items-center justify-center rounded-full bg-border-light text-text-secondary-light dark:bg-border-dark dark:text-text-secondary-dark opacity-50">
                            <span class="material-symbols-outlined">chevron_left</span>
                        </div>
                    {% endif %}
                    
                    {% for num in page_obj.paginator.page_range %}
                        {% if page_obj.number == num %}
                            <span class="flex h-10 w-10 items-center justify-center rounded-full bg-primary text-white text-sm font-bold">
                                {{ num }}
                            </span>
                        {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                            <a href="?q={{ query }}&page={{ num }}" class="flex h-10 w-10 items-center justify-center rounded-full text-sm font-medium hover:bg-primary/10 dark:hover:bg-primary/20 transition-colors text-text-light dark:text-text-dark">
                                {{ num }}
                            </a>
                        {% endif %}
                    {% endfor %}
                    
                    {% if page_obj.has_next %}
                        <a href="?q={{ query }}&page={{ page_obj.next_page_number }}" class="flex h-10 w-10 cursor-pointer items-center justify-center overflow-hidden rounded-full bg-border-light text-text-secondary-light dark:bg-border-dark dark:text-text-secondary-dark hover:bg-primary/10 dark:hover:bg-primary/20 transition-colors">
                            <span class="material-symbols-outlined">chevron_right</span>
                        </a>
                    {% else %}
                        <div class="flex h-10 w-10 items-center justify-center rounded-full bg-border-light text-text-secondary-light dark:bg-border-dark dark:text-text-secondary-dark opacity-50">
                            <span class="material-symbols-outlined">chevron_right</span>
                        </div>
                    {% endif %}
                </nav>
                {% endif %}
            {% else %}
                <!-- No Results -->
                <div class="flex flex-col items-center justify-center py-20">
                    <span class="material-symbols-outlined text-6xl text-text-secondary-light dark:text-text-secondary-dark mb-4">search_off</span>
                    <p class="text-2xl font-bold mb-2 text-text-light dark:text-text-dark">No Results Found</p>
                    <p class="text-text-secondary-light dark:text-text-secondary-dark text-center max-w-md">
                        We couldn't find any posts matching "{{ query }}". Try using different keywords or browse <a href="{% url 'blog:post_list' %}" class="text-primary hover:underline">all posts</a>.
                    </p>
                </div>
            {% endif %}
        {% else %}
            <!-- No Search Performed -->
            <div class="flex flex-col items-center justify-center py-20">
                <span class="material-symbols-outlined text-6xl text-text-secondary-light dark:text-text-secondary-dark mb-4">search</span>
                <p class="text-2xl font-bold mb-2 text-text-light dark:text-text-dark">Start Your Search</p>
                <p class="text-text-secondary-light dark:text-text-secondary-dark">Enter keywords in the search box above to find posts.</p>
            </div>
        {% endif %}
    </div>
</main>
{% endblock %}
